# Copyright 2020-2022 SubQuery Pte Ltd authors & contributors
# SPDX-License-Identifier: Apache-2.0

fragment ProjectFields on Project {
  id
  owner
  metadata
  deploymentMetadata
  deploymentId
  updatedTimestamp
  createdTimestamp
  deployments {
    nodes {
      serviceAgreements {
        aggregates {
          sum {
            lockedAmount
          }
        }
        totalCount
      }
      indexers {
        totalCount
      }
    }
  }
}

fragment ProjectUpdateField on Project {
  id
  owner
  metadata
  updatedTimestamp
  totalReward
  deployments {
    nodes {
      serviceAgreements {
        aggregates {
          sum {
            lockedAmount
          }
        }
        totalCount
      }
      indexers {
        totalCount
      }
    }
  }
}

query GetProject($id: String!) {
  project(id: $id) {
    ...ProjectFields
  }
}

query GetProjects($offset: Int, $orderBy: [ProjectsOrderBy!] = ID_ASC, $ids: [String!] = [""]) {
  projects(first: 10, offset: $offset, orderBy: $orderBy, filter: { id: { notIn: $ids } }) {
    totalCount
    nodes {
      ...ProjectFields
    }
  }
}

query GetProjectsAll {
  projects(orderBy: ID_ASC) {
    nodes {
      ...ProjectUpdateField
    }
  }
}

query GetProjectDeployments($projectId: String!) {
  project(id: $projectId) {
    deployments {
      totalCount
      nodes {
        id
        metadata
        createdTimestamp
      }
    }
  }
}
